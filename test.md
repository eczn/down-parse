理解 IP 以及它的技术集 

IP 协议是现代计算机网络的基石，是网络层最重要的协议，解决了主机到主机的通信，可是总有些问题不容易看得清楚： 

现代网络为什么是基于分组交换的，主机到主机的通信又要怎么样完成才是最好的？ 

NAT 技术又是怎样最大限度的利用有限的 IP 的 ？ 

局域网、路由器、防火墙？

要认识这些，首先得理解 IP 的含义，它太重要了，以至于不理解 IP 就说明你根本不懂网络。 

# IPv4 

为了使问题理解的方便，这里的 IP 都是指 IPv4 的四子节 IP 也就是下面这样的： 

``` bash
127.0.0.1 
```

# 主机到主机的通信模式

两台主机间要完成一次通信，最简单的方式就是可以直接建立实际的、物理上的连接，这是早期电话网络的工作方式： 

Alice 打电话给 Bob，信号从 Alice 的电话里流出到电话公司的 `集线站` 然后，接线员首先会跟 Alice 接通并问他： 

> "你要打给谁？"
> "打给 Bob" 
> "好"

随后，接线员会吧 Alice 和 Bob 的电话线接在一起，之后进行通话。 

这种方式叫做 `电路交换` 

这种方式显然是不适合现代网络的，怎么会有这么多机器人帮忙接线，哪来的这么多线？哪来的这么多集线站？ 

这样来看，在现代互联网的实现上使用电路交换显然是不切实际的。 

后来就有了其他实现的提出，比如 `报文交换`，他是这样的： 

1. `线站` 依然存在
2. Alice 跟 Bob 通信的时候，会吧数据封装成一个 `报文`, 上面写着 `送往位于 B 线站的 Bob` 
3. Alice 的电脑吧这个报文发给 Alice所在的线站，然后那个线站会根据报文上写的目的地传给 B 线站
4. B 线站接受到之后转发给 Bob 

问题似乎都解决了，上面的这样的通信模式似乎还挺不错的，也更自动化了。 

而实际上，这种报文交换有几个严重的问题： 

1. 如果报文很大，那么一次传输出现差错则整个通信都得重新进行一次 
2. Alice所在的线站到 B 线站的带宽不是无限的，很容易卡，因为两个线站的全部人都公用这一条线


考虑到以上问题，现代的网络采用的是 `分组交换` 的通信模式，它是 `报文交换` 的升级版，主要是网络自身独有的分布式特性导致的： 

1. `线站` 依然存在
2. Alice 跟 Bob 通信的时候，会吧数据封装成一个 `报文`, 上面写着 `送往位于 B 线站的 Bob` 
3. Alice 的电脑发送这个报文的时候并不是一次性发送，而是分割成多组发给 Alice 所在的线站 A，A 线站会根据报文上写的目的地传给 B 线站，或者一部分分组传给 C 线站，让 C 线站传给 B 线站 
4. B 线站接受到之后陆陆续续转发给 Bob 

总体来看，报文被分组了，通信出差错也只是其中的一个分组错了， 重新通信也只需重发这个分组就 OK 而且，分组的去向可以是随意的，不固定的，但是最终会抵达 B 线站。 


# IP 地址 

现代网络普遍使用 `分组交换` 来实现网络通信，其中所谓 Bob 的地址，其实就是 IP 地址，以下是一个典型的 IPv4 地址： 

``` bash 
222.41.2.109
```




# 路由器

你可能已经注意到了，所谓线站其实就是路由器。

网络理论中经典的路由器只做一件事： 实现IP包的分组交换 

分组交换其实就难在要根据怎么样的规则来决定把包发给哪个路由器，如下图所示： 

。。。。 

其中，xxx 一整条路径可以叫做 `路由` 而决定包如何路由主要是： 

1. 静态路由表 
2. 动态路由表 

静态路由表就是钦定好的路径，动态路由表是根据一些算法使得路由器学习得到的路由表



